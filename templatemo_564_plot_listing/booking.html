<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>BD Booking - Hệ thống đặt phòng chuyên nghiệp</title>
    <!-- Ant Design CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/antd/4.16.13/antd.min.css">
    <!-- CSS tùy chỉnh -->
    <link rel="stylesheet" href="assets/css/booking.css">
    <!-- Phông chữ Google -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet">
    <!-- Font Awesome cho biểu tượng -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <div class="logo-container">
                <img src="assets/images/logoBD.jpg" alt="BD Logo" class="logo">
                <span class="site-title">BD Booking</span>
            </div>
            <nav class="site-nav">
                <a href="#">Trang chủ</a>
                <a href="#">Phòng</a>
                <a href="#">Dịch vụ</a>
                <a href="#">Liên hệ</a>
                <a href="#">Giới thiệu</a>
            </nav>
            <div class="menu-toggle" id="mobile-menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content container">
            <h1>Chào mừng đến với BD Booking</h1>
            <p>Trải nghiệm đặt phòng dễ dàng và nhanh chóng với giao diện hiện đại.</p>
            <a href="#roomGallery" class="primary-btn hero-btn">Khám phá ngay</a>
        </div>
    </section>

    <!-- Sorting Section -->
    <section class="sorting-section container">
        <div class="sorting-controls">
            <label for="sort">Sắp xếp theo:</label>
            <select id="sort">
                <option value="price">Giá</option>
                <option value="rating">Xếp hạng</option>
            </select>
            <label for="arrange">Hiển thị:</label>
            <select id="arrange">
                <option value="grid">Lưới</option>
                <option value="list">Danh sách</option>
            </select>
        </div>
    </section>

    <!-- Room Gallery Section -->
    <section class="room-section container">
        <div id="roomGallery" class="room-gallery">
            <!-- Các thẻ phòng sẽ được tạo động bởi JavaScript -->
        </div>
        <!-- Pagination Buttons -->
        <div class="pagination">
            <button class="pagination-btn" onclick="prevPage()">« Trước</button>
            <span id="pageIndicator">Trang 1 / 1</span>
            <button class="pagination-btn" onclick="nextPage()">Tiếp »</button>
        </div>
    </section>

    <!-- Booking Section -->
    <section id="bookingSection" class="booking-section container">
        <div class="booking-header">
            <div class="room-info">
                <h2 id="selectedRoomName">Phòng 101</h2>
                <ul class="room-features">
                    <li><i class="fas fa-snowflake"></i> Điều hòa không khí</li>
                    <li><i class="fas fa-video"></i> Máy chiếu</li>
                    <li><i class="fas fa-chalkboard"></i> Bảng trắng</li>
                    <li><i class="fas fa-wifi"></i> Wi-Fi</li>
                </ul>
            </div>
            <img id="selectedRoomImage" src="assets/images/Public-Room.jpg" alt="Phòng 101" class="room-image">
        </div>
        <div class="details">
            <h3>Chọn Ngày & Giờ Đặt Phòng</h3>
            <label for="datePicker">Ngày:</label>
            <input type="date" id="datePicker" class="date-input">
            <label for="timeSlot">Khoảng thời gian:</label>
            <select id="timeSlot" class="time-slot">
                <option value="morning">Buổi sáng (8h - 12h)</option>
                <option value="afternoon">Buổi chiều (13h - 17h)</option>
                <option value="evening">Buổi tối (18h - 22h)</option>
                <option value="fullDay">Cả ngày</option>
            </select>
            <button id="checkAvailabilityBtn" class="primary-btn check-btn">Kiểm tra tính khả dụng</button>
            <p id="availabilityStatus"></p>
        </div>
        <div class="services-section">
            <h3>Thêm Dịch Vụ <span>(Di chuột để biết chi tiết)</span></h3>
            <button id="addServicesBtn" class="primary-btn">Chọn dịch vụ</button>
            <div id="servicesOptions" style="display:none;">
                <label title="Đồ uống được cung cấp"><input type="checkbox" class="service-checkbox" id="cafeService" data-price="15000"> Dịch vụ Cafe - 15.000đ</label>
                <label title="In ấn và photocopy"><input type="checkbox" class="service-checkbox" id="printService" data-price="20000"> Dịch vụ In ấn - 20.000đ</label>
                <label title="Đồ ăn nhẹ và bữa ăn nhẹ"><input type="checkbox" class="service-checkbox" id="snackService" data-price="25000"> Dịch vụ Snack - 25.000đ</label>
                <label title="Trang trí phòng theo yêu cầu"><input type="checkbox" class="service-checkbox" id="decorService" data-price="30000"> Dịch vụ Trang trí - 30.000đ</label>
            </div>
        </div>
        <div class="total">
            <p>Tổng cộng: <span id="totalPrice">0</span>đ</p>
            <button id="paymentBtn" class="primary-btn">Tiến hành thanh toán</button>
        </div>
    </section>

    <!-- User Information Section -->
    <section class="user-info-section container">
        <h3>Thông Tin Khách Hàng</h3>
        <form id="userForm" class="user-form">
            <label for="name">Họ và tên đầy đủ:</label>
            <input type="text" id="name" required placeholder="Nhập họ và tên đầy đủ của bạn">
            <label for="email">Email:</label>
            <input type="email" id="email" required placeholder="Nhập email của bạn">
            <label for="phone">Số điện thoại:</label>
            <input type="text" id="phone" required placeholder="Nhập số điện thoại của bạn">
            <label for="notes">Ghi chú:</label>
            <textarea id="notes" placeholder="Nhập bất kỳ ghi chú nào nếu có"></textarea>
            <button type="submit" class="primary-btn">Gửi Thông Tin</button>
        </form>
    </section>

    <!-- Booking Summary Section -->
    <section class="booking-summary container">
        <h3>Tóm Tắt Đặt Phòng</h3>
        <p>Phòng: <span id="summaryRoom">Phòng 101</span></p>
        <p>Ngày: <span id="summaryDate"></span></p>
        <p>Khoảng thời gian: <span id="summaryTimeSlot"></span></p>
        <p>Dịch vụ: <span id="summaryServices"></span></p>
        <p>Tổng giá: <span id="summaryTotalPrice">0</span>đ</p>
        <button id="confirmBtn" class="primary-btn">Xác Nhận Đặt Chỗ</button>
    </section>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <p>© 2024 BD.COM. Mọi quyền được bảo lưu bởi Công ty BD.</p>
            <p>Hotline: 0123 456 789 | Email: support@bd.com</p>
            <div class="social-media">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/antd/4.16.13/antd.min.js"></script>
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <!-- JavaScript tùy chỉnh -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const { Modal, notification } = antd;

            const roomsPerPage = 6; // Số phòng hiển thị trên mỗi trang
            let currentPage = 1;
            let totalPages = 1;

            // Danh sách phòng (thêm nhiều phòng để thử nghiệm phân trang)
            const rooms = [
                { id: 'Phòng 101', price: 1000000, image: 'Public-Room.jpg', rating: 4.5 },
                { id: 'Phòng 102', price: 1100000, image: 'Public-Room.jpg', rating: 4.0 },
                { id: 'Phòng 103', price: 1200000, image: 'Public-Room.jpg', rating: 4.2 },
                { id: 'Phòng 104', price: 1300000, image: 'Public-Room.jpg', rating: 4.3 },
                { id: 'Phòng 105', price: 1400000, image: 'Public-Room.jpg', rating: 4.1 },
                { id: 'Phòng 106', price: 1500000, image: 'Public-Room.jpg', rating: 5.0 },
                { id: 'Phòng 107', price: 1600000, image: 'Public-Room.jpg', rating: 3.9 },
                { id: 'Phòng 108', price: 1700000, image: 'Public-Room.jpg', rating: 4.7 },
                { id: 'Phòng 109', price: 1800000, image: 'Public-Room.jpg', rating: 4.6 },
                { id: 'Phòng 110', price: 1900000, image: 'Public-Room.jpg', rating: 4.8 },
                { id: 'Phòng 111', price: 2000000, image: 'Public-Room.jpg', rating: 4.9 },
                { id: 'Phòng 112', price: 2100000, image: 'Public-Room.jpg', rating: 5.0 },
                // Thêm các phòng khác nếu cần
            ];

            totalPages = Math.ceil(rooms.length / roomsPerPage);

            const roomGallery = document.getElementById('roomGallery');
            const sortSelect = document.getElementById('sort');
            const arrangeSelect = document.getElementById('arrange');
            const pageIndicator = document.getElementById('pageIndicator');

            function displayRooms(page) {
                roomGallery.innerHTML = '';
                const startIndex = (page - 1) * roomsPerPage;
                const endIndex = startIndex + roomsPerPage;
                const roomsToDisplay = rooms.slice(startIndex, endIndex);

                roomsToDisplay.forEach(createRoomCard);
                pageIndicator.innerText = `Trang ${currentPage} / ${totalPages}`;
            }

            // Hàm tạo thẻ phòng
            function createRoomCard(room) {
                const roomCard = document.createElement('div');
                roomCard.classList.add('room-card');

                roomCard.innerHTML = `
                    <img src="assets/images/${room.image}" alt="${room.id}">
                    <div class="card-content">
                        <h3>${room.id}</h3>
                        <p class="room-price">${room.price.toLocaleString('vi-VN')}đ/ngày</p>
                        <button class="primary-btn view-details-btn">Xem chi tiết</button>
                    </div>
                    <div class="hover-icons">
                        <button class="add-favorite-btn"><i class="fas fa-heart"></i></button>
                        <button class="view-gallery-btn"><i class="fas fa-eye"></i></button>
                    </div>
                `;

                // Thêm sự kiện cho các nút
                roomCard.querySelector('.view-details-btn').addEventListener('click', function () {
                    selectRoom(room.id);
                });

                roomCard.querySelector('.add-favorite-btn').addEventListener('click', function () {
                    addToFavorite(room.id);
                });

                roomCard.querySelector('.view-gallery-btn').addEventListener('click', function () {
                    viewRoomGallery(room.id);
                });

                roomGallery.appendChild(roomCard);
            }

            // Các hàm phân trang
            function nextPage() {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayRooms(currentPage);
                }
            }

            function prevPage() {
                if (currentPage > 1) {
                    currentPage--;
                    displayRooms(currentPage);
                }
            }

            // Sắp xếp phòng
            function sortRooms() {
                const sortValue = sortSelect.value;
                if (sortValue === 'price') {
                    rooms.sort((a, b) => a.price - b.price);
                } else if (sortValue === 'rating') {
                    rooms.sort((a, b) => b.rating - a.rating);
                }
                currentPage = 1;
                totalPages = Math.ceil(rooms.length / roomsPerPage);
                displayRooms(currentPage);
            }

            // Thay đổi chế độ hiển thị
            function arrangeRooms() {
                const arrangeValue = arrangeSelect.value;
                if (arrangeValue === 'list') {
                    roomGallery.classList.add('list-view');
                } else {
                    roomGallery.classList.remove('list-view');
                }
            }

            // Thêm các hàm vào phạm vi toàn cục để có thể gọi từ HTML
            window.nextPage = nextPage;
            window.prevPage = prevPage;
            window.sortRooms = sortRooms;
            window.arrangeRooms = arrangeRooms;

            // Hàm thêm vào Yêu thích
            function addToFavorite(roomName) {
                notification.success({
                    message: 'Đã thêm vào mục Yêu thích',
                    description: `${roomName} đã được thêm vào mục yêu thích của bạn!`
                });
            }

            // Hàm xem thư viện ảnh
            function viewRoomGallery(roomName) {
                Modal.info({
                    title: `Thư viện ảnh của ${roomName}`,
                    content: `<div><img src="assets/images/${roomName.replace(/ /g, "-")}.jpg" alt="${roomName}" style="width: 100%"></div>`,
                });
            }

            // Hàm chọn phòng
            function selectRoom(roomId) {
                // Cập nhật thông tin phòng đã chọn
                document.getElementById('selectedRoomName').innerText = roomId;
                document.getElementById('selectedRoomImage').src = `assets/images/${roomId.replace(/ /g, "-")}.jpg`;
                document.getElementById('summaryRoom').innerText = roomId;
                // Cuộn đến phần đặt phòng
                document.getElementById('bookingSection').scrollIntoView({ behavior: 'smooth' });
                // Cập nhật giá tổng
                updateTotalPrice();
            }

            // Dữ liệu để đặt dịch vụ
            let selectedServices = {};
            let bookingDetails = {
                start_time: null,
                end_time: null,
                slots: {}
            };

            // Các phần tử trong trang đặt chỗ
            const datePicker = document.getElementById('datePicker');
            const timeSlot = document.getElementById('timeSlot');
            const serviceCheckboxes = document.querySelectorAll('.service-checkbox');
            const confirmBookingBtn = document.getElementById('confirmBtn');

            // Khi hộp kiểm dịch vụ được chọn
            serviceCheckboxes.forEach((checkbox) => {
                checkbox.addEventListener('change', function () {
                    if (checkbox.checked) {
                        selectedServices[checkbox.id] = parseInt(checkbox.dataset.price, 10);
                    } else {
                        delete selectedServices[checkbox.id];
                    }
                    updateTotalPrice();
                    updateSummaryServices();
                });
            });

            function updateTotalPrice() {
                let totalPrice = 0;
                // Tính giá phòng
                const selectedRoomName = document.getElementById('selectedRoomName').innerText;
                const selectedRoom = rooms.find(room => room.id === selectedRoomName);
                if (selectedRoom) {
                    totalPrice += selectedRoom.price;
                }
                // Tính giá dịch vụ
                for (let price of Object.values(selectedServices)) {
                    totalPrice += price;
                }
                document.getElementById('totalPrice').innerText = totalPrice.toLocaleString('vi-VN');
                document.getElementById('summaryTotalPrice').innerText = totalPrice.toLocaleString('vi-VN');
            }

            function updateSummaryServices() {
                const serviceNames = Object.keys(selectedServices).map(serviceId => {
                    switch (serviceId) {
                        case 'cafeService':
                            return 'Dịch vụ Cafe';
                        case 'printService':
                            return 'Dịch vụ In ấn';
                        case 'snackService':
                            return 'Dịch vụ Snack';
                        case 'decorService':
                            return 'Dịch vụ Trang trí';
                        default:
                            return '';
                    }
                });
                document.getElementById('summaryServices').innerText = serviceNames.join(', ');
            }

            // Cập nhật chi tiết đặt phòng
            function updateBookingDetails() {
                const selectedDate = datePicker.value;
                const selectedTimeSlot = timeSlot.value;
                if (selectedDate && selectedTimeSlot) {
                    bookingDetails.start_time = selectedDate;
                    bookingDetails.end_time = calculateEndTime(selectedDate, selectedTimeSlot);
                    bookingDetails.slots = { [selectedTimeSlot]: [selectedDate] };
                    document.getElementById('summaryDate').innerText = selectedDate;
                    document.getElementById('summaryTimeSlot').innerText = timeSlot.options[timeSlot.selectedIndex].text;
                }
            }

            datePicker.addEventListener('change', updateBookingDetails);
            timeSlot.addEventListener('change', updateBookingDetails);

            // Hàm tính thời gian kết thúc
            function calculateEndTime(startDate, selectedTimeSlot) {
                let endTime;
                switch (selectedTimeSlot) {
                    case 'morning':
                        endTime = new Date(startDate);
                        endTime.setHours(12, 0, 0);
                        break;
                    case 'afternoon':
                        endTime = new Date(startDate);
                        endTime.setHours(17, 0, 0);
                        break;
                    case 'evening':
                        endTime = new Date(startDate);
                        endTime.setHours(22, 0, 0);
                        break;
                    default:
                        endTime = new Date(startDate);
                        endTime.setHours(23, 59, 59);
                }
                return endTime.toISOString().split('T')[0];
            }

            // Xác thực thông tin đặt phòng
            function validateBookingDetails() {
                return datePicker.value && timeSlot.value;
            }

            // Xử lý việc gửi biểu mẫu người dùng cho đặt phòng
            confirmBookingBtn.addEventListener('click', function () {
                if (!validateBookingDetails()) {
                    notification.error({
                        message: 'Nhập không hợp lệ',
                        description: 'Vui lòng điền chính xác tất cả các trường bắt buộc.'
                    });
                    return;
                }

                // Giá trị giả cho bookingId và roomName
                const bookingId = "123456";
                const roomName = document.getElementById('selectedRoomName').innerText;

                // Chuẩn bị dữ liệu cho API
                const dataToSend = {
                    service: selectedServices,
                    start_time: bookingDetails.start_time,
                    end_time: bookingDetails.end_time,
                    slots: bookingDetails.slots
                };

                // Gửi dữ liệu đến backend
                sendBookingDataToBackend(bookingId, roomName, dataToSend);
            });

            // Hàm gửi dữ liệu đặt phòng đến API backend
            async function sendBookingDataToBackend(bookingId, roomName, data) {
                const url = `/api/${bookingId}/${roomName}/bookingdetails`;
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    if (response.ok) {
                        const responseData = await response.json();
                        notification.success({
                            message: 'Đã xác nhận đặt phòng',
                            description: `Booking ID: ${responseData.data.bookingVersion}`
                        });
                    } else {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Yêu cầu đặt phòng không thành công');
                    }
                } catch (error) {
                    notification.error({
                        message: 'Lỗi đặt phòng',
                        description: error.message
                    });
                }
            }

            // Hiển thị/Ẩn danh sách dịch vụ
            const addServicesBtn = document.getElementById('addServicesBtn');
            const servicesOptions = document.getElementById('servicesOptions');
            addServicesBtn.addEventListener('click', function () {
                if (servicesOptions.style.display === 'none' || servicesOptions.style.display === '') {
                    servicesOptions.style.display = 'block';
                } else {
                    servicesOptions.style.display = 'none';
                }
            });

            // Khởi tạo hiển thị phòng
            displayRooms(currentPage);

            // Thêm sự kiện cho sắp xếp và hiển thị
            sortSelect.addEventListener('change', sortRooms);
            arrangeSelect.addEventListener('change', arrangeRooms);

            // Menu di động
            const mobileMenu = document.getElementById('mobile-menu');
            const nav = document.querySelector('.site-nav');
            mobileMenu.addEventListener('click', function () {
                nav.classList.toggle('active');
                mobileMenu.classList.toggle('is-active');
            });
        });
    </script>
</body>
</html>
